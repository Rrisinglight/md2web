<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Профиль - Markdown to web</title>
    <!-- Подключение шрифта Noto -->
    <link
      href="https://fonts.googleapis.com/css2?family=Noto+Sans&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css"
    />
    <style>
      body {
        font-family: "Noto Sans", sans-serif;
      }
    </style>
  </head>
  <body class="bg-gray-100 min-h-screen">
    <header class="bg-gray-800 text-white p-4">
      <div class="container mx-auto flex justify-between items-center">
        <a href="{{ url_for('index') }}" class="text-xl font-bold"
          >Markdown to web</a
        >
        <nav>
          <a href="{{ url_for('logout') }}" class="hover:text-gray-300"
            >Выйти</a
          >
        </nav>
      </div>
    </header>
    <main class="container mx-auto p-4">
      {% with messages = get_flashed_messages() %} {% if messages %}
      <div
        class="bg-blue-100 border-l-4 border-blue-500 text-blue-700 p-4 mb-4"
        role="alert"
      >
        {% for message in messages %}
        <p>{{ message }}</p>
        {% endfor %}
      </div>
      {% endif %} {% endwith %}
      <div class="bg-white rounded-lg shadow-md p-6 mb-6">
        <h2 class="text-2xl font-semibold mb-4">
          Профиль пользователя: {{ session.username }}
        </h2>
        <div class="bg-gray-100 p-4 rounded-lg mb-4">
          <h3 class="text-lg font-medium mb-2">Использование хранилища</h3>
          <div class="w-full bg-gray-300 rounded-full h-4 mb-2">
            <div
              class="bg-blue-600 h-4 rounded-full"
              style="width: {{ (total_size_mb / storage_limit_mb) * 100 }}%"
            ></div>
          </div>
          <p class="text-sm text-gray-600">
            Использовано {{ total_size_mb|round(2) }} MB из {{ storage_limit_mb
            }} MB ({{ storage_left_mb|round(2) }} MB свободно)
          </p>
        </div>
        <div class="flex justify-between">
          <a
            href="{{ url_for('index') }}"
            class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded"
          >
            <i class="fas fa-file-upload mr-2"></i>Загрузить новый документ
          </a>
        </div>
      </div>
      <div class="bg-white rounded-lg shadow-md p-6">
        <h2 class="text-2xl font-semibold mb-4">Ваши документы</h2>
        {% if documents %}
        <div class="overflow-x-auto">
          <table class="min-w-full bg-white">
            <thead>
              <tr>
                <th
                  class="py-2 px-4 border-b border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase"
                >
                  Превью
                </th>
                <th
                  class="py-2 px-4 border-b border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase"
                >
                  Название
                </th>
                <th
                  class="py-2 px-4 border-b border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase"
                >
                  Дата создания
                </th>
                <th
                  class="py-2 px-4 border-b border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase"
                >
                  Срок хранения
                </th>
                <th
                  class="py-2 px-4 border-b border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase"
                >
                  Действия
                </th>
              </tr>
            </thead>
            <tbody>
              {% for doc_id, filename, created_at, expires_at, preview_url in
              documents %}
              <tr>
                <td class="py-2 px-4 border-b border-gray-200">
                  {% if preview_url %}
                  <img src="{{ preview_url }}" alt="Превью" class="h-10" />
                  {% else %} — {% endif %}
                </td>
                <td class="py-2 px-4 border-b border-gray-200">
                  {{ filename }}
                </td>
                <td class="py-2 px-4 border-b border-gray-200">
                  {{ created_at }}
                </td>
                <td class="py-2 px-4 border-b border-gray-200">
                  {% if expires_at %} Истекает: {{ expires_at }} {% else %}
                  Бессрочно {% endif %}
                </td>
                <td class="py-2 px-4 border-b border-gray-200">
                  <a
                    href="{{ url_for('view_document', document_id=doc_id) }}"
                    class="text-blue-600 hover:text-blue-800 mr-2"
                  >
                    <i class="fas fa-eye"></i>
                  </a>
                  <a href="#" class="text-red-600 hover:text-red-800">
                    <i class="fas fa-trash-alt"></i>
                  </a>
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
        {% else %}
        <div class="text-center py-4">
          <p class="text-gray-500">У вас пока нет документов.</p>
          <a
            href="{{ url_for('index') }}"
            class="mt-2 inline-block text-blue-600 hover:text-blue-800"
          >
            Загрузить первый документ
          </a>
        </div>
        {% endif %}
      </div>
    </main>
    <footer class="bg-gray-800 text-white p-4 mt-8">
      <div class="container mx-auto text-center">
        <p>&copy; 2025 Markdown to web. Все права защищены.</p>
      </div>
    </footer>
  </body>
</html>